<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>The Giant Outdoors</title>
	
  <link href="bootstrap3/css/bootstrap.css" rel="stylesheet" />
	<link href="assets/css/get-shit-done.css" rel="stylesheet" />  
  <link href="assets/css/giantoutdoors.css" rel="stylesheet" /> 
    
  <!--     Font Awesome     -->
<!--   <link href="bootstrap3/css/font-awesome.css" rel="stylesheet">
 --><!--   <link href='http://fonts.googleapis.com/css?family=Grand+Hotel' rel='stylesheet' type='text/css'>
 -->

  <!--    Leaflet     -->
  <link rel="stylesheet" href="assets/css/leaflet.css" />
  <script src="assets/js/leaflet-src.js"></script>
  <script src="assets/js/leaflet.markercluster.js"></script>
  <script src="assets/js/oms.min.js"></script>

</head>
<body>
  <div class="intro">
    <video id="video" src="assets/video/intro.mp4"></video>
    <a class="close btn btn-info btn-fill">Skip</a>
  </div>
  <div class="row1">
      <div class="logoholder">
        <img class="logo" src="assets/img/logo-wide.png"/>
      </div>
      <div class="col-md-6 modebuttons btn-group">
              <a href="#" id="btnexplore" class="btn btn-info btnswitch" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Explore the area">
<!--                     <img src="assets/img/wellies.png"/>
-->                    Explore
              </button>
              <a href="#" id="btndig" class="btn btn-info btn-fill btnswitch" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Dig down through history"><!--                     <img src="assets/img/spade.png"/>
-->Dig
              </button>
              <a href="mailto:example@thegiantoutdoors.org?subject=Add your story&body=my history..." class="btn btn-info btn-fill" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Add your own history">
<!--                     <img src="assets/img/camera.png"/>
-->                    Add
              </a>
      </div>
      <div class="maplayerbuttons btn-group">
          <button href="#fakelink" class="btn-tilelayer btn btn-info btn-fill">Map</button>
          <button href="#fakelink" class="btn-tilelayer btn btn-info">Satellite</button>
      </div>
  </div>
  <div id="contentholder">
    
    <div id="map">
      <div id="sliderholder">
        <div id="slider2"  data-toggle="tooltip" data-placement="right" title="Display date whilst dragging or hovering"></div>
      </div>
    </div>

    <div id="walkholder">
      <a class="leaflet-popup-close-button" href="#close">Ã—</a>
      <h3 class="title"></h3>
      <img class="photo"/>
      <h4 class="subtitle"></h4>
      <p class="description"></p>
      <span class="infotitle">Start: </span><span class="start info"></span>
      <span class="infotitle">End: </span><span class="end info"></span>
      <span class="infotitle">Parking: </span><span class="parking info"></span>
      <span class="infotitle">Difficulty: </span><span class="difficulty info"></span>
    </div>

  </div>
</body>
  <style type="text/css">


  </style>
  <script src="jquery/jquery-1.10.2.js" type="text/javascript"></script>
	<script src="assets/js/jquery-ui-1.10.4.custom.min.js" type="text/javascript"></script>

	<script src="bootstrap3/js/bootstrap.js" type="text/javascript"></script>
  <script src="assets/js/easing.js"></script>

  <script src="assets/js/custom.js"></script>
  <script src="assets/js/intro.js"></script>
  <script src="assets/js/map.js"></script>


  <script src="assets/geojson/walk1.geojson"></script>
  <script src="assets/geojson/data.geojson"></script>

  <script type="text/javascript">
    $(function(){

      $("#walkholder .leaflet-popup-close-button").click(function(){
        $("#walkholder").hide();
      });

      $("#btndig, #btnexplore").click(function(){
        console.log($(this).text());
        $(".btnswitch").addClass("btn-fill");
        $(this).removeClass("btn-fill");
        if($(this).attr('id') == "btndig"){
          mapm.switchModes("dig");
        } else {//Explore
          mapm.switchModes("explore");
          showHideMarkers();
        }
      });

      mapm.switchModes('dig');//Set up default page


      var hanziNums = ["2014 AD", "2013 AD", "2010 AD", "2008 AD", "2000 AD", "1968 AD", "1900 AD", "1840 AD", "1700 AD", "1400 AD", "0 BC", "1000 BC", "2000 BC", "3000 BC"];

      $("#slider2").slider({
        orientation: "vertical",
        range: "min",
        min: 0,
        max: 100,
        value: 100,
        slide: function( event, ui ) {
          var maxDate = 2015;
          var minDate = -3000;

          var modPercentage = EasingFunctions.easeOutCubic(ui.value/100)
          var onepercent = 5015 / 100;
          var range = [];
          range.push(minDate + ((modPercentage * 100 * onepercent) - 1 * onepercent));
          range.push(minDate + ((modPercentage * 100 * onepercent) + 1 * onepercent));
          console.log(range[0], range[1]);

          //Range needs to be from +1 to -1
          showHideMarkers(range);
        }
      });

      $('#sliderholder').mousedown(function(e){
        return false;
      });
    });
         
    // - - - - - - - Surround with logic - - - - - - - - - - -
    // introVideo.play();
    // introVideo.onEnd(function(){
    //   initMap();
    // });

    function initMap(){

    }

    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })

    $('.btn-tooltip').tooltip();
    $('.label-tooltip').tooltip();
    $('.pick-class-label').click(function(){
        var new_class = $(this).attr('new-class');  
        var old_class = $('#display-buttons').attr('data-class');
        var display_div = $('#display-buttons');
        if(display_div.length) {
          var display_buttons = display_div.find('.btn');
          display_buttons.removeClass(old_class);
          display_buttons.addClass(new_class);
          display_div.attr('data-class', new_class);
        }
    });
    $( "#slider-range" ).slider({
  		range: true,
  		min: 0,
  		max: 500,
  		values: [ 75, 300 ],
    });
  	$( "#slider-default" ).slider({
  			value: 70,
  			orientation: "horizontal",
  			range: "min",
  			animate: true
  	});
  	$('.carousel').carousel({
      interval: 4000
    });

    function walkClicked(marker){
      var props = marker.feature.properties;
      $("#walkholder").show();
      $("#walkholder .title").text(props.title);
      $("#walkholder .subtitle").text(props.subtitle);
      $("#walkholder .description").text(props.description);
      $("#walkholder .start").text(props.start);
      $("#walkholder .end").text(props.end);
      $("#walkholder .parking").text(props.parking);
      $("#walkholder .photo").attr("src", "assets/content/" + props.photo);
      $("#walkholder .difficulty").text(props.difficulty);
      this.feature.properties;
    }


    mapm.oms.addListener('click', function(marker) {
      //Show element
      var props = marker.feature.properties;
      popup.setContent(props.Description);
      popup.setLatLng(marker.getLatLng());
      mapm.map.openPopup(popup);
    });

    function onEachWalk(feature, layer) {
        // does this feature have a property named popupContent?
        

        /*layer.on('click', onClick);
        */

        // if (feature.properties && feature.properties.popupContent) {
        //     layer.bindPopup(feature.properties.popupContent);
        // }
    }

    mapm.layers.walks = L.geoJson(walk1, {
      style: {
        color: '#f00',
        weight: 3,
        opacity: 0.7
      },
      onEachFeature: onEachWalk
    });

    function onEachFeatureFun(feature, layer) {
        // does this feature have a property named popupContent?
        //&& feature.properties.popupContent
        if (feature.properties) {
          var props = feature.properties;
          var htmlString = "";
          if(props.Image && props.Image != undefined){
            htmlString += "<img class='width100' src='assets/content/" + props.Image + "'/>";
          }
          htmlString += "<h4>" + props.Title + "</h4>" +
              "<p>" + props.Description + "</p>";
            layer.bindPopup(
              htmlString
              //feature.properties.popupContent
            );
        }
    }

    var baseballIcon = L.icon({
      iconUrl: 'assets/img/marker-icon-orange-2x.png',
      iconSize: [25, 41],
      iconAnchor: [12, 0],
      popupAnchor: [0, 0]
    });

    var markers;

    var popup = new L.Popup();
    mapm.oms.addListener('click', function(marker) {
      popup.setContent(marker.desc);
      popup.setLatLng(marker.getLatLng());
      mapm.map.openPopup(popup);
    });

  // var loc = new L.LatLng(50.188214, -5.293300);
  // var marker = new L.Marker(loc);
  // map.addLayer(marker);
  // oms.addMarker(marker);

  // var marker2 = new L.Marker(loc);

  //   map.addLayer(marker2);
  // oms.addMarker(marker2);

    function loadMarkers(){
      markers = L.geoJson(data, {
        //onEachFeature: onEachFeatureFun,
        pointToLayer: function (feature, latlng) {
          switch (feature.properties["Marker Type"]) {
            case 'other site, orange': return L.marker(latlng, {icon: baseballIcon});
          }
            return L.marker(latlng);
        },
        // pointToLayer: function (feature, latlng) {
        //   return;// L.marker(latlng, {icon: baseballIcon});
        // }
      });
    }

    loadMarkers();

    function showHideMarkers(dates){
      mapm.oms.clearMarkers();
      for (var ma in markers._layers) {
        mapm.map.removeLayer(markers._layers[ma]);//Remove stale markers
        //Filter
        if(filterMarker(dates, markers._layers[ma])){
          markers._layers[ma].addTo(mapm.map);
          mapm.oms.addMarker(markers._layers[ma]);
        }
      }
    }

    function filterMarker(dates, feature){
      feature = feature.feature;
      if(typeof dates != 'object'){
        return true;
      }
      if(feature.properties.StartDate > dates[0] && feature.properties.StartDate < dates[1]){
        console.log(feature.properties.StartDate + " is between: " + dates[0] + " and " + dates[1]);
        return true;
      } else {
        return false;
      }
    }

    showHideMarkers();

    $(".btn-tilelayer").click(function(){
      mapm.map.removeLayer(mapm.layers["satellite"]);
      mapm.map.removeLayer(mapm.layers["road"]);
      console.log($(this)[0].textContent);
      if($(this)[0].textContent == "Satellite"){
        mapm.map.addLayer(mapm.layers["satellite"]);
      } else {
        mapm.map.addLayer(mapm.layers["road"]);
      }

      $(".btn-tilelayer").addClass("btn-fill");//Add class to all buttons
      $(this).removeClass('btn-fill');//Remove class from this button
    });
</script>
</html>